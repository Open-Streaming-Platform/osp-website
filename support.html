<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
        <link rel="shortcut icon" href="/img/favicon.ico">
        <link rel="manifest" href="/img/site.webmanifest">

        <link rel="stylesheet" href="/css/main.css">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <link rel="stylesheet" href="/vendor/fontawesome-free-5.10.2-web/css/all.css">

    </head>
    <body>
        <nav class="navbar navbar-expand-lg navbar-light bg-white">
            <a class="navbar-brand" href="/">
                <h3>
                    <img id="navlogo" class="d-inline-block" width=48 height=48 src="/img/osplogo_nav.png" >
                    <b>Open Streaming Platform</b>
                </h3>
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item active px-2">
                        <a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item px-2">
                        <a class="nav-link" href="https://osptest.divby0.net">Demo</a>
                    </li>
                    <li class="nav-item px-2">
                        <a class="nav-link" href="/support" >Support</a>
                    </li>
                    <li class="nav-item px-2">
                        <a class="nav-link" href="https://blog.divby0.net">Blog</a>
                    </li>
                    <li class="nav-item px-2">
                        <a class="nav-link" href="/contribute">Contribute</a>
                    </li>
                    <li class="nav-item px-2">
                        <a class="nav-link" href="https://gitlab.com/Deamos/flask-nginx-rtmp-manager"><img src="/img/gitlab.png" height="48"></a>
                    </li>
                    <li class="nav-item px-2">
                        <a class="nav-link" href="https://discord.gg/Jp5rzbD"><img src="/img/discord.png" height="48"></a>
                    </li>
                </ul>
            </div>
        </nav>
        <div class="banner-image">
            <img class="shadow" src="/img/banner.jpg" width="100%" height="300px">
        </div>

        <div class="container-fluid">
        <div class="row">
            <div class="pt-4 col-sm-12 col-md-10 col-lg-8 mx-auto">
                <h1 id="top">Help</h1>
            </div>
            <div class="pt-4 col-sm-12 col-md-10 col-lg-8 mx-auto">
                <ul class="list-unstyled">
                    <li><a href="#A">Installing</a></li>
                    <ul>
                        <li><a href="#AA">Requirements</a></li>
                        <li><a href="#A0">Automatic Install</a></li>
                        <li><a href="#A1">Manual Install</a></li>
                        <li><a href="#A2">Docker Install</a></li>
                    </ul>
                    <li><a href="#B">Upgrading</a></li>
                    <ul>
                        <li><a href="#B0">Standard Upgrade</a></li>
                    </ul>
                    <li><a href="#0">Streaming to OSP</a></li>
                    <ul>
                        <li><a href="#00">With OBS</a></li>
                        <li><a href="#01">With ffmpeg</a></li>
                        <li><a href="#02">Transcoding</a></li>
                        <li><a href="#03">Latency</a></li>
                    </ul>
                    <li><a href="#1">Webhooks</a></li>
                    <ul>
                        <li><a href="#10">Examples</a></li>
                        <ul>
                            <li><a href="#100">Discord</a></li>
                            <li><a href="#101">Rocket.Chat</a></li>
                        </ul>
                    </ul>
                    <li><a href="#2">API</a></li>
                    <ul>
                        <li><a href="#21">Example</a></li>
                    </ul>
                    <li><a href="#3">Clips</a></li>
                    <li><a href="#4">Video Uploads</a></li>
                    <li><a href="#5">Channel Protection</a></li>
                    <li><a href="#6">Troubleshooting</a></li>
                </ul>
            </div>
            <div class="pt-4 col-sm-12 col-md-10 col-lg-8 mx-auto">
                <h1 id="A">Installing</h1>
                <h4 id="AA">Requirements</h4>
                <p>
                    <ul>
                        <li>Ubuntu 18.04 or Later, Debian 10 or Later</li>
                        <li>Python 3.7 or later</li>
                        <li>MySQL 5.7.7 or later, or MariaDB > 10.1, if not using SQLite</li>
                        <li>SMTP Mail Server for Email Address Validation and Subscriptions</li>
                        <li>FFMPEG 3 or greater</li>
                    </ul>
                </p>
                <h4 id="A0">Automatic Install</h4>
                <p>
                    OSP has been tested on Ubuntu 18.04 and Recent Debian Builds. The installation script may not work properly on other OS's.
                    <li> 1) Clone the Gitlab Repo <br>
                        <code class="codeblock">git clone https://gitlab.com/Deamos/flask-nginx-rtmp-manager.git</code>
                    </li>
                    <li> 2) Run the install script<br>
                        <code class="codeblock">cd flask-nginx-rtmp-manager/setup </code><br>
                        <code class="codeblock">sudo bash setup-osp.sh</code>
                    </li>
                    <li>The installation script will install the files in the following location:
                        <ul>
                            <li>Video Files, Video Stream Files, and User Uploaded Images: /var/www </li>
                            <li>OSP Files: /opt/osp</li>
                            <li>Nginx Config Files: /usr/local/nginx/conf/</li>
                        </ul>
                    </li>
                    <li> 3) Rename the Configuration File <br>
                        <code class="codeblock">cd /opt/osp/conf </code> <br>
                        <code class="codeblock">sudo mv config.py.dist config.py</code>
                    </li>
                    <li> 4) Edit the Default Values in the Configuration File<br>
                        <code class="codeblock">vi config.py</code>
                    </li>
                    <li> 6) Change the following values from their Default:<br>
                        <ul>
                            <li>dbLocation - By Default, OSP uses SQLite, but you can change this value to use MySQL or Maria DB. See <a href="https://docs.sqlalchemy.org/en/13/core/engines.html">https://docs.sqlalchemy.org/en/13/core/engines.html</a> for more info on format</li>
                            <li>secretKey - Flask Secret Key, change this!</li>
                            <li>passwordSalt - Flask Security uses this value for Salting User Passwords, change this!</li>
                        </ul>
                    </li>
                    <li> 7) Restart the OSP service<br>
                        <code class="codeblock">sudo systemctl restart osp</code>
                    </li>
                    <li> 8) Open a Web Browser and configure OSP<br>
                        <code class="codeblock">http://[SERVER IP]/</code>
                    </li>
                </p>
                <h4 id="A1">Manual Install</h4>
                <p>Coming Soon...</p>
                <h4 id="A2">Docker Install</h4>
                <p>Coming Soon...</p>
                <a href="#top"><i class="fas fa-arrow-circle-up"></i> top</a>
                <h1 id="B">Upgrading</h1>
                <h4 id="B0">Standard Upgrade</h4>
                <p>
                    <ul>
                        <li>Backup your Nginx.conf and Database File:<br>
                            <code class="codeblock">sudo cp /usr/local/nginx/conf/nginx.conf /usr/local/nginx/conf/nginx.conf.bak</code>
                            <code class="codeblock">sudo cp /opt/osp/db/database.db /opt/osp/db/database.bak</code>
                        </li>
                        <li>Perform a Git Pull<br>
                            <code class="codeblock">cd /opt/osp</code><br>
                            <code class="codeblock">sudo git pull</code><br>
                        </li>
                        <li>Rerun the OSP Setup Script - Updates any Dependencies and Rebuilds Nginx<br>
                            <code class="codeblock">cd setup </code><br>
                            <code class="codeblock">sudo bash setup-osp.sh</code>
                        </li>
                        <li>Verify your Nginx.conf and make any needed changes<br>
                            <code class="codeblock">sudo vi /usr/local/nginx/conf/nginx.conf</code>
                        </li>
                        <li>Run the DB Upgrade Script to Ensure the Database Schema is up-to-date<br>
                            <code class="codeblock">sudo bash dbUpgrade.sh</code>
                        </li>
                        <li>Restart Nginx and OSP<br>
                            <code class="codeblock">sudo systemctl restart nginx-osp</code><br>
                            <code class="codeblock">sudo systemctl restart osp</code>
                        </li>
                    </ul>
                </p>
                <a href="#top"><i class="fas fa-arrow-circle-up"></i> top</a>
                <h2 id="0">Streaming to OSP</h2>
                <p>
                    In order to stream to OSP, a channel with a valid stream key is needed. After creating a channel, the streaming program must be set to the corresponding URL<br>
                    <code class="text-success ml-4">rtmp://Site FQDN or IP/stream/&lt;steam-key&gt;</code><br>
                    Note that only registered users with the <em>streamer</em> role are able to stream to OSP.<br>
                    <br>
                    OSP is configured by default with the following settings:<br>
                    <ul>
                        <li><b>hls_framents:</b> 1 second</li>
                        <li><b>hls_playlist_length:</b> 10 seconds</li>
                    </ul>
                    Alterations to the the Nginx-RTMP configuration can be made by editing the osp-rtmp.conf file in /usr/local/nginx/conf.  More information on the Nginx-RTMP directives can be found at <a href="https://github.com/arut/nginx-rtmp-module/wiki/Directives">https://github.com/arut/nginx-rtmp-module/wiki/Directives</a>
                </p>
                <h4 id="00">With OBS</h4>
                <h5>Reduced Delay Setup (5 seconds)</h5>
                <p>Reduced Delay Streams can be achieved in OSP using the following settings:<br>
                <img src="/img/OBS_LowLatency.jpg">
                </p>
                <h4 id="01">With ffmpeg</h4>
                <p>Coming Soon...</p>
                <h4 id="02">Transcoding</h4>
                <p>
                    <em>Transcoding</em> or <em>adaptive streaming</em> is possible with OSP. It can be enabled globally in the admin settings. However, this feature uses the CPU of the server to re-encode the streams and requires a lot of CPU power. It's possible to utilize GPUs instead by changing the encoder used by ffmpeg in the <code class="text-success">osp-rtmp.conf</code>. Enabling transcoding will increase the stream latency. It may be necessary to increase the playlist length (see <a href="#03">Latency</a>).
                </p>
                <p>
                    By default, nginx has been configured to transcode 1080p, 720p, 480p, & 360p. You can optimize how streams are transcoded by editing the <code class="text-success">osp-rtmp.conf</code> file and following the instructions <a href="https://licson.net/post/setting-up-adaptive-streaming-with-nginx/">here</a>.
                </p>
                <h4 id="03">Latency</h4>
                <p>
                    OSP uses HLS to serve RTMP streams to clients. This brings a certain latency by design. The default configuration of nginx is fine-tuned to reduce the latency as far as possible while providing stable HLS streams. For this configuration it is imporant that the encoder sends a keyframe every second! The latency should be 4.5 to 5 seconds.<br>
                    If streams are buffering, it's most likely because of a suboptimal network connection. In this case, increase the <code class="text-success">hls_playlist_length</code> in the <code class="text-success">osp-rtmp.conf</code>. The latency will increase with a longer playlist length.
                </p>
                <p>
                    RTMP capable players (e.g. <a href="https://www.videolan.org">VLC</a>) can access the RTMP stream directly. The URL is available in the <em>share</em> dialog below the stream. The latency of the RTMP stream should be 1 to 2 seconds.
                </p>
                <a href="#top"><i class="fas fa-arrow-circle-up"></i> top</a>
            </div>
            <div class="pt-4 col-sm-12 col-md-10 col-lg-8 mx-auto">
                <h2 id="1">Webhooks</h2>
                <p>
                    OSP can send HTTP requests (GET,POST,PUT,DELETE) to notify other services about various triggers. Webhooks can be set globally in the admin settings and per channel by users. The HTTP requests are entirely definable (see <a href="#10">Examples</a> below).<br>
                </p>
                <p>
                    Currently supported triggers:
                </p>
                <ul>
                    <li>At the Start of a Live Stream</li>
                    <li>At the End of a Live Stream</li>
                    <li>On a New Viewer Joining a Live Stream</li>
                    <li>On a Stream Upvote</li>
                    <li>On a Stream Metadata Change (Name/Topic)</li>
                    <li>On a Stream Chat Message</li>
                    <li>On Posting of a New Video to a Channel</li>
                    <li>On a New Video Comment</li>
                    <li>On a Video Upvote</li>
                    <li>On a Video Metadata Change (Name/Topic)</li>
                </ul>
                <p>
                    When defining a webhook payload, various variables can be set which will be replaced with live data at the time the webhook is run. Webhook variables are defined as the following:
                </p>
                <ul>
                    <li>%channelname%</li>
                    <li>%channelurl%</li>
                    <li>%channeltopic%</li>
                    <li>%channelimage%</li>
                    <li>%streamer%</li>
                    <li>%channeldescription%</li>
                    <li>%streamname%</li>
                    <li>%streamurl%</li>
                    <li>%streamtopic%</li>
                    <li>%streamimage%</li>
                    <li>%user%</li>
                    <li>%userpicture%</li>
                    <li>%videoname%</li>
                    <li>%videodate%</li>
                    <li>%videodescription%</li>
                    <li>%videotopic%</li>
                    <li>%videourl%</li>
                    <li>%videothumbnail%</li>
                    <li>%comment%</li>
                </ul>
                <h4 id="10">Examples</h4>
                <h5 id="100">Discord</h5>
                <p>
                    Type: <b>POST</b><br>
                    Trigger event: <b>Stream start</b>
                </p>
                <p>
                    <b>Header</b>
                </p>
                <pre class="px-2 mx-5"><code>
    {
        "Content-Type": "application/json"
    }
                </code></pre>
                <p>
                    <b>Payload</b>
                </p>
                <pre class="px-2 m-5"><code>
    {
        "content": "%channelname% went live on OSP Test",
        "username": "OSP Bot",
        "embeds": [
            {
                "title": "%streamurl%",
                "url": "%streamurl%",
                "color": 6570404,
                "image": {
                "url": "%channelimage%"
            },
            "author": {
                "name": "%streamer% is now streaming"
            },
            "fields": [
                {
                    "name": "Channel",
                    "value": "%channelname%",
                    "inline": true
                },
                {
                    "name": "Topic",
                    "value": "%streamtopic%",
                    "inline": true
                },
                {
                    "name": "Stream Name",
                    "value": "%streamname%",
                    "inline": true
                },
                {
                    "name": "Description",
                    "value": "%channeldescription%",
                    "inline": true
                }
            ]
            }
        ]
    }
                </code></pre>
                <h5 id="101">Rocket.Chat</h5>
                <p>Coming Soon...</p>
                <a href="#top"><i class="fas fa-arrow-circle-up"></i> top</a>
            </div>
            <div class="pt-4 col-sm-12 col-md-10 col-lg-8 mx-auto">
                <h2 id="2">API</h2>
                <p>
                    OSP provides a self-documenting API using <a href="https://swagger.io">swagger.io</a>. The API can be accessed at http(s)://Site FQDN or IP/apiv1". For authenticated endpoints, an API key is needed, which can be created by users with the <em>streamer</em> role in the user menu to the top right. Requests to authenticated endpoints must have the <code class="text-success">'X-API-KEY':</code> header field set with a valid API key.
                </p>
                <h5 id="21">Example</h5>
                <p>
                    In this example a chat message is sent to a chat channel endpoint.
                </p>
                <p>
                    Username: botname<br>
                    Message: beep bob<br>
                    Endpoint: channels/chat/72223bf3-be79-4a2a-88d9-c7bdce271f0e<br>
                    API key: d26de1eb2d48a784e109b29025632fc1a0211a2ffbede09672c8cf6f4321fb0000c49cb243e2d07e
                </p>
                <pre class="px-2 mx-5"><code>
    curl -X POST "http://localhost/apiv1/channels/chat/72223bf3-be79-4a2a-88d9-c7bdce271f0e?username=botname&message=beep%20bop" \
    -H  "accept: application/json" -H  "X-API-KEY: d26de1eb2d48a784e109b29025632fc1a0211a2ffbede09672c8cf6f4321fb0000c49cb243e2d07e"
                </code></pre>
                <a href="#top"><i class="fas fa-arrow-circle-up"></i> top</a>
            </div>
            <div class="pt-4 col-sm-12 col-md-10 col-lg-8 mx-auto">
                <h2 id="3">Clips</h2>
                <p>Coming Soon...</p>
                <a href="#top"><i class="fas fa-arrow-circle-up"></i> top</a>
            </div>
            <div class="pt-4 col-sm-12 col-md-10 col-lg-8 mx-auto">
                <h2 id="4">Video uploads</h2>
                <p>Coming Soon...</p>
                <a href="#top"><i class="fas fa-arrow-circle-up"></i> top</a>
            </div>
            <div class="pt-4 col-sm-12 col-md-10 col-lg-8 mx-auto">
                <h2 id="5">Channel protection</h2>
                <p>Coming Soon...</p>
                <a href="#top"><i class="fas fa-arrow-circle-up"></i> top</a>
            </div>
            <div class="pt-4 col-sm-12 col-md-10 col-lg-8 mx-auto">
                <h2 id="6">Troubleshooting</h2>
                <p>
                    <ul>
                        <li>
                            <h6>OSP opens fine but when you try to stream to it, the stream never displays on the live channel page</h6>
                            <ul> - Check the Admin Settings under Site Protocol and Site Address.  Incorrect values can cause the system to not pass the stream off properly to Nginx-RTMP.</ul>
                        </li>
                        <li>
                            <h6>OSP doesn't open properly.  The tv static error pages doesn't show and instead, a basic 500 error page is given</h6>
                            <ul> - Ensure the OSP service (sudo systemctl start osp) has been started. If it continues to fail, check the OSP logs at /var/log/gunicorn/error.log</ul>
                        </li>
                    </ul>
                </p>
                <a href="#top"><i class="fas fa-arrow-circle-up"></i> top</a>
            </div>
        </div>
    </div>
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>
</html>